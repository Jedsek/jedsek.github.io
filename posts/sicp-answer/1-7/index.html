<!doctype html><html class=scroll-smooth lang=zh-Hans><head><meta charset=utf-8><link crossorigin href=/manifest.json rel=manifest><script src=/scripts/custom/loadscript.js></script><link href=/styles/third_party/highlight.min.css rel=stylesheet><link href=/styles/third_party/highlight_themes/atom-one-dark.css rel=stylesheet><script src=/scripts/third_party/pjax.min.js></script><script src=/scripts/third_party/quicklink.umd.min.js></script><script src=/scripts/third_party/jquery.min.js></script><script src=/scripts/third_party/highlight/highlight.min.js></script><script src=/scripts/third_party/highlight/languages/rust.min.js></script><script src=/scripts/third_party/highlight/languages/nix.min.js></script><script src=/scripts/third_party/highlight/languages/haskell.min.js></script><script src=/scripts/third_party/highlight/languages/gleam.min.js></script><script src=/scripts/third_party/highlight/languages/scheme.min.js></script><link href=/iconfonts/iconfont.css rel=stylesheet><link href=/styles/custom/tailwind.css rel=stylesheet><link href=/styles/custom/style.css rel=stylesheet><script src=/scripts/custom/pjax.js></script><script src=/scripts/custom/pwa_install.js></script><script>document.documentElement.setAttribute(`data-theme`,`dark`)</script><script>if(navigator.serviceWorker!=null){navigator.serviceWorker.register(`/sw.js`).then((a=>{console.log(`Registered events at scope: `,a.scope)}))}</script><script>var GetCookie=(a=>{let e=0;var b=document.cookie.split(`;`);for(var c=e;c<b.length;c++){var d=b[c].split(`=`);if(a==d[e]){return unescape(d[1])}};return null});var SetCookie=((a,b)=>{document.cookie=a+ `=`+ escape(b)+ `; SameSite=None; Secure;`});var scrollback=(()=>{let a=`scroll`;if(GetCookie(a)!=null){const b=GetCookie(a);document.documentElement.scrollTo({top:b,left:0,behavior:`instant`})}})</script><script>window.addEventListener(`load`,()=>{quicklink.listen()})</script><script>loadExternalScript(`//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js`,(()=>{console.log(`External script loaded and executed.`)}));document.addEventListener(`pjax:complete`,(()=>{loadExternalScript(`//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js`,(()=>{console.log(`External script loaded and executed.`)}))}))</script><title> Jedsek | Blog </title><body onscroll='SetCookie("scroll",document.documentElement.scrollTop);' class=flex id=body onload=scrollback();><script src=/scripts/custom/fireworks.js></script><div class="flex flex-rol grow"><div class="content w-80 flex flex-col break-words pr-2 border-2 grow border-b-0 border-neutral-800 animate-in fade-in slide-in-from-top-8 duration-1000" style=background-color:#3b3b3b><div class=break-words style=min-height:100vh><div class="p-4 flex justify-center text-4xl" style=opacity:.84>sicp-answer~> 1-7</div><div class=p-4><h1 id=dai-ma>代码</h1><p>下面是书中求平方根的代码:<pre class=language-scheme data-lang=scheme><code class=language-scheme data-lang=scheme>(define (sqrt-iter guess x)
  (if (good-enough? guess x)
    guess
    (sqrt-iter (improve guess x) x)))

(define (sqrt x)
  (sqrt-iter 1.0 x))
</code></pre><p>以及一些辅助函数/过程:<pre class=language-scheme data-lang=scheme><code class=language-scheme data-lang=scheme>(define (square x)
  (* x x))

(define (average x y)
  (/ (+ x y) 2))

(define (improve guess x)
  (average guess (/ x guess)))

(define (good-enough? guess x)
  (< (abs (- (square guess) x)) 0.001))
</code></pre><hr><h1 id=wen-ti>问题</h1><p>这里的 <code>good-enough?</code>, 有一些比较隐晦的问题<p>它通过 <code>guess * guess - x</code> 的绝对值是否小于 <code>0.001</code>, 来判断是否足够接近答案<br> 但当你要求一个很小很小很小很小的数字的平方根时, 不管怎么样, 差值的绝对值都肯定远小于 <code>0.001</code> 这个锚点<br> 也就是说当数字超级小时, 根据我们给的约束, 不管怎么样都是足够逼近的<p>举个例子: <code>0.000009 = 0.003 * 0.003</code>, 因此我们希望 <code>(sqrt 0.000009)</code> 的结果差不多是 <code>0.003</code><pre class=language-scheme data-lang=scheme><code class=language-scheme data-lang=scheme>(sqrt 0.000009)
; 0.03134584760656851
</code></pre><p>0.03, 0.003, 两者差了整整一个数量级! 这是因为我们定的锚点是 <code>0.001</code>, 这对于太小的数字实在是不够用<br> 将 0.03 作为 <code>guess</code> 反代进 <code>good-enough?</code> 中, 则 <code>0.03 * 0.03 = 0.0009</code>, 而 <code>abs(0.000009 - 0.0009)</code> 为 <code>0.000891</code><br> 这小于 0.001, 那么自然应该算作 "足够逼近的标准", 毕竟是我们自己定义的这么一个精度<p>当你要求星球之间的距离精确到 0.1m 时这毫无问题 当你要求原子之间的距离精确到 0.1m 时......嘛......<p>为了更好地理解, 我们可以修改一下 <code>good-enough?</code>:<pre class=language-scheme data-lang=scheme><code class=language-scheme data-lang=scheme>(define (good-enough? guess x)
  (<= (abs (- (* guess guess) x)) 1))

(sqrt 2)
; 1.5
</code></pre><p>我们将 <code>0.001</code> 改成了 <code>1</code>, 于是当我们传入某个一般大的数字(这里是2)时, 会因为精度要求太大, 求得1.5就认为足够逼近了<p>那么可能就有人要说了:<br> 既然 0.001 作为精度不够, 那么我来一个 0.0000000000000001<pre class=language-scheme data-lang=scheme><code class=language-scheme data-lang=scheme>(define (good-enough? guess x)
  (<= (abs (- (square guess) x)) 0.0000000000000001))

(sqrt 2)
</code></pre><p>此时会发生无限死循环, 因为我们给的精度要求实在是太小, 再加上浮点数误差(应该说, <code>不准确(inexact)</code>), 导致永远无法达到要求<br> 以上述代码为例, guess 的数值会是:<pre class=language-scheme data-lang=scheme><code class=language-scheme data-lang=scheme>1.0
1.5
1.4166666666666665
1.4142156862745097
1.4142135623746899
1.414213562373095
1.414213562373095
1.414213562373095
1.414213562373095
1.414213562373095
1.414213562373095
1.414213562373095
</code></pre><p>我们实际上已经算出来了 <code>1.414213562373095</code> 这个值, 但因为 <code>good-enough?</code> 的精度要求太小, 其永远返回 <code>#f</code><br> 且因为浮点数不准确的原因, <code>(improve 1.414213562373095 2)</code> 等于 <code>1.414213562373095</code><br> 因此我们将永远无限循环下去<p>对于很大很大很大很大的数字也是一样的道理:<br> 因为数字太大, 能够作为小数部分的数字随着数字的数量级增大, 是有限的<br> 当对这样的数字进行计算时, 最后的结果因为无法表示某个相当准确的浮点数, 只能将末尾的小数进行四舍五入来保存<br> 因此对于很大的数字, 一样有可能造成无限死循环<hr><h1 id=jie-jue>解决</h1><p>既然你这也不行那也不行, 0.001你嫌弃, 0.00000000001你也嫌弃, 那怎么办! (愤怒)<br> 正如题目给出的提示: 不是监视差值, 而是监视 guess 迭代时的变化情况<p>只要上一次的guess, 与这一次的guess, 两者之间的变化值, 与这一次的 guess 比较<br> 只要改变值相对于猜测值的比率很小, 那么就算作已经足够逼近<p>因此我们需要修改先前的函数:<pre class=language-scheme data-lang=scheme><code class=language-scheme data-lang=scheme>(define (good-enough? old-guess guess)
  (> 0.01
    (/ (abs (- guess old-guess))
        old-guess)))

(define (sqrt-iter guess x)
  (if (good-enough? guess (improve guess x))
    (improve guess x)
    (sqrt-iter (improve guess x) x)))
</code></pre><p>这样已经基本上解决了先前的问题, 当然我们也可以将 0.01 写成 0.00001 来变得更加准确<hr><p>上一篇: <a href=/posts/sicp-answer/1-6>1-6</a><br> 下一篇: <a href=/posts/sicp-answer/1-8>1-8</a></div></div><div class=bottom-footer style=height:140vh><div class="flex flex-col text-center border-t-2 py-8" style=background-color:#3b3b3b><span> <i class="iconfont icon-aixin text-red-500 align-middle"> </i> <span class=opacity-70> Jedsek </span> </span></div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class=pl-4><span> 哈喽, 哈喽!!!! 这里应该算是一个几乎不算彩蛋的小彩蛋吧? 只有当你浏览具有 目录|TOC 的文章时, 此段才会渲染<br> 其实这里是特意留白出来的底部 footer, 保证了当你点击右侧的 目录|TOC 且是最后一个 anchor 时, 一定能高亮它 <br> <br> 你可以想象一下, 如果没有这段 footer, 那么点击锚点时, 当最后一段目录的内容只有几行字时 <br> 由于底部行数过少, 就只能高亮到上面的锚点啦! <br> <br> 毕竟我高亮目录的实现思路, 是获取当前滚动的Y偏移量, 与锚点对应的 h1/h2 在博客左侧主体的Y偏移量, 进行计算来判断高亮哪个~ <br> 简单来说, 当 (window.scrollY + 200) >= anchor.offsetTop 时, 就会选择这个anchor, 随后进行高亮 <br> <br> 你可以试试在浏览器中按 F12 打开开发者工具, ctrl-c 选择此处 class 名称为 "bottom-footer" 的 div, 然后删除该结点 <br> 然后按 F12 退出开发者工具, 随后点击右侧的 目录|TOC 中的结点, 当最后一个 anchor 的内容过少时, 锚点无法被高亮 <br> 当然, 当最后一个 anchor 的行数稍微多一些时, 照样能够高亮最后一个目录 <br> <br> 如果你发现有无法高亮的情况, 嗯......那应该不太可能呢, 诶嘿～ </span><br><br></div><br></div></div><div class="sidebar flex-col w-48" style=display:flex><script>var show_sidebar_at_startup=(()=>{const a=document.getElementsByClassName(`sidebar`)[0];if(/Mobi|Android|iPhone/i.test(navigator.userAgent)&&a.style.display==`flex`){a.style.display=`none`}});show_sidebar_at_startup()</script><div class="nav flex flex-col gap-2 pb-auto opacity-100 text-center p-2" style=background-color:#2e2e2e><a class="text-xl font-medium no-underline hover:scale-110 duration-300" href=/ style=background-color:#2e2e2e> Jedsek's blog </a><span class="text-sm italic" style=background-color:#2e2e2e> 与其浊富 | 宁比清贫 </span><a href=/about style=background-color:#2e2e2e> <img class="my-avatar p-2 duration-300 hover:scale-110 hover:rotate-12 hover:rounded-3xl hover:opacity-80" src=/images/avatar.webp style=background-color:#2e2e2e> </a><nav class="px-2 pt-1"><ul class="list-none pl-0" id=menu><li class="hover:scale-110 hover:opacity-60 hover:duration-300 hover:translate-x-2 hover:-translate-y-2 py-1 animate-in fade-in slide-in-from-bottom duration-1000"><a class="no-underline block" href=/> <i class="iconfont icon-home left"></i> <span class="iconfont mr-10">首页</span> </a><li class="hover:scale-110 hover:opacity-60 hover:duration-300 hover:translate-x-2 hover:-translate-y-2 py-1 animate-in fade-in slide-in-from-top duration-1000"><a class="no-underline block" href=/about> <i class="iconfont icon-about left"></i> <span class="iconfont mr-10">关于</span> </a><li class="hover:scale-110 hover:opacity-60 hover:duration-300 hover:translate-x-2 hover:-translate-y-2 py-1 animate-in fade-in slide-in-from-bottom duration-1000"><a class="no-underline block" href=/sayings> <i class="iconfont icon-yulu left"> </i> <span class="iconfont mr-10">语录</span> </a><li class="hover:scale-110 hover:opacity-60 hover:duration-300 hover:translate-x-2 hover:-translate-y-2 py-1 animate-in fade-in slide-in-from-top duration-1000"><a class="no-underline block" href=/categories> <i class="iconfont icon-Z-fenleidaohang left"></i> <span class="iconfont mr-10">分类</span> </a><li class="hover:scale-110 hover:opacity-60 hover:duration-300 hover:translate-x-2 hover:-translate-y-2 py-1 animate-in fade-in slide-in-from-bottom duration-1000"><a class="no-underline block" href=/novels> <i class="iconfont icon-config_s left"></i> <span class="iconfont mr-10">小说</span> </a></ul></nav></div><script></script><div class="sticky top-0"><aside class="toc flex flex-col border-t-2 px-2 py-1 my-2"><div class="text-center text-2xl">目录|TOC</div><ul class="list-none px-2 text-left"><li class="pb-0 leading-normal animate-in fade-in slide-in-from-bottom duration-1000"><a class=text-sm href=#dai-ma>代码</a><li class="pb-0 leading-normal animate-in fade-in slide-in-from-bottom duration-1000"><a class=text-sm href=#wen-ti>问题</a><li class="pb-0 leading-normal animate-in fade-in slide-in-from-bottom duration-1000"><a class=text-sm href=#jie-jue>解决</a></ul></aside></div></div><div class="float-botton flex"><a class="float-botton-item no-underline" href=#> <i class="iconfont icon-arrowup"></i> </a><div class=float-bottton-seperator></div><div class="float-botton-item float-botton-toggle-sidebar" type=button><i class="iconfont icon-sidebar"></i></div></div></div><script src=/scripts/custom/ul.js></script><script src=/scripts/third_party/lightgallery.min.js></script><script src=/scripts/custom/fancybox.js></script><script src=/scripts/custom/codeblock.js></script><script src=/scripts/custom/sidebar.js></script><script src=/scripts/custom/toc.js></script><script>hljs.highlightAll();document.addEventListener(`pjax:complete`,()=>{hljs.highlightAll()})</script>