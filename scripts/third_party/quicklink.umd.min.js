!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(e.quicklink={})}(this,function(e){function o(t){return new Promise(function(e,n,r){(r=new XMLHttpRequest).open("GET",t,r.withCredentials=!0),r.onload=function(){(200===r.status?e:n)()},r.send()})}var n,i=(n=document.createElement("link")).relList&&n.relList.supports&&n.relList.supports("prefetch")?function(t){return new Promise(function(e,n,r){(r=document.createElement("link")).rel="prefetch",r.href=t,r.onload=e,r.onerror=n,document.head.appendChild(r)})}:o,w=window.requestIdleCallback||function(e){var n=Date.now();return setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-n))}})},1)},g=new Set,E=new Set,v=!1;function c(e){if(e){if(e.saveData)return new Error("Save-Data is enabled");if(/2g/.test(e.effectiveType))return new Error("network conditions are poor")}return!0}function y(e,n,r){var t=c(navigator.connection);return t instanceof Error?Promise.reject(new Error("Cannot prefetch, "+t.message)):(0<E.size&&!v&&console.warn("[Warning] You are using both prefetching and prerendering on the same document"),Promise.all([].concat(e).map(function(e){if(!g.has(e))return g.add(e),(n?function(e){return window.fetch?fetch(e,{credentials:"include"}):o(e)}:i)(new URL(e,location.href).toString())})))}function b(e,n){var r=c(navigator.connection);if(r instanceof Error)return Promise.reject(new Error("Cannot prerender, "+r.message));if(!HTMLScriptElement.supports("speculationrules"))return y(e),Promise.reject(new Error("This browser does not support the speculation rules API. Falling back to prefetch."));if(document.querySelector('script[type="speculationrules"]'))return Promise.reject(new Error("Speculation Rules is already defined and cannot be altered."));for(var t=0,o=[].concat(e);t<o.length;t+=1){var i=o[t];if(window.location.origin!==new URL(i,window.location.href).origin)return Promise.reject(new Error("Only same origin URLs are allowed: "+i));E.add(i)}0<g.size&&!v&&console.warn("[Warning] You are using both prefetching and prerendering on the same document");r=function(e){var n=document.createElement("script");n.type="speculationrules",n.text='{"prerender":[{"source": "list","urls": ["'+Array.from(e).join('","')+'"]}]}';try{document.head.appendChild(n)}catch(e){return e}return!0}(E);return!0===r?Promise.resolve():Promise.reject(r)}e.listen=function(r){var t,o,i,n,c,u,a,e,s,f,l,d,h,p;if(r=r||{},window.IntersectionObserver)return d=r.throttle||1/0||1,h=[],t=(e=[function(e){1<h.push(e)||m()},function(){p--,m()}])[p=0],o=e[1],i=r.limit||1/0,n=r.origins||[location.hostname],c=r.ignores||[],u=r.delay||0,a=[],e=r.timeoutFn||w,s="function"==typeof r.hrefFn&&r.hrefFn,f=r.prerender||!1,v=r.prerenderAndPrefetch||!1,l=new IntersectionObserver(function(e){e.forEach(function(e){var n;e.isIntersecting?(a.push((e=e.target).href),n=function(){-1!==a.indexOf(e.href)&&(l.unobserve(e),(v||f)&&E.size<1?b(s?s(e):e.href).catch(function(e){if(!r.onError)throw e;r.onError(e)}):g.size<i&&!f&&t(function(){y(s?s(e):e.href,r.priority).then(o).catch(function(e){o(),r.onError&&r.onError(e)})}))},u?setTimeout(n,u):n()):-1<(n=a.indexOf((e=e.target).href))&&a.splice(n)})},{threshold:r.threshold||0}),e(function(){(r.el||document).querySelectorAll("a").forEach(function(e){n.length&&!n.includes(e.hostname)||function n(r,e){return Array.isArray(e)?e.some(function(e){return n(r,e)}):(e.test||e).call(e,r.href,r)}(e,c)||l.observe(e)})},{timeout:r.timeout||2e3}),function(){g.clear(),l.disconnect()};function m(){p<d&&0<h.length&&(h.shift()(),p++)}},e.prefetch=y,e.prerender=b});
